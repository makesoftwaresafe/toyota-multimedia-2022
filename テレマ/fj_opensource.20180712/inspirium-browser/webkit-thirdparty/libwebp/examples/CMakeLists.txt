CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

ADD_DEFINITIONS(-DWEBP_DLL)
ADD_DEFINITIONS(
	-DWEBP_HAVE_JPEG
#	-DWEBP_HAVE_PNG
)

SET(LIBWEBP_EXAMPLES_HEADERS
	stopwatch.h
	pngdec.h
	wicdec.h
	jpegdec.h
	gif2webp_util.h
	tiffdec.h
	webpdec.h
	example_util.h
	metadata.h
)

SET(LIBWEBP_EXAMPLES_SOURCES
	webpdec.c
	metadata.c
	jpegdec.c
	tiffdec.c
	wicdec.c
	pngdec.c
	example_util.c
)

SET(GIF2WEBP_SOURCES
	gif2webp_util.c
	gif2webp.c
)

SET(VWEBP_SOURCES
	vwebp.c
)

SET(CWEBP_SOURCES
	cwebp.c
)

SET(DWEBP_SOURCES
	dwebp.c
)

SET(WEBPMUX_SOURCES
	webpmux.c
)

INCLUDE_DIRECTORIES(
	../src
)

INCLUDE_DIRECTORIES(
	${3RDPARTY_DIR}/libjpeg
	${3RDPARTY_DIR}/libpng
	${3RDPARTY_DIR}/zlib
)

ADD_LIBRARY(examples_webp_util STATIC ${LIBWEBP_EXAMPLES_HEADERS} ${LIBWEBP_EXAMPLES_SOURCES})
SET_TARGET_PROPERTIES(examples_webp_util PROPERTIES FOLDER "webp")

MACRO(CONSTRUCT_EXAMPLES name sources)
	ADD_EXECUTABLE(${name} ${sources})
	ADD_DEPENDENCIES(${name} ${LIBWEBP_LIBRARY_NAME} ${LIBPNG_LIBRARY_NAME} ${LIBJPEG_LIBRARY_NAME} ${ZLIB_LIBRARY_NAME})
	TARGET_LINK_LIBRARIES(${name} examples_webp_util  ${LIBWEBP_LIBRARY_NAME}  ${LIBPNG_LIBRARY_NAME} ${LIBJPEG_LIBRARY_NAME} ${ZLIB_LIBRARY_NAME})
	SET_TARGET_PROPERTIES(${name} PROPERTIES FOLDER "webp")

	IF(COMPILE_WINCE_UNDER_WIN32)
	ELSEIF("${PORT}" STREQUAL "Unix")
	ELSEIF("${PORT}" STREQUAL "Android")
	ELSE()
		SET_TARGET_PROPERTIES(${name} PROPERTIES
		        LINK_FLAGS "/ENTRY:\"mainACRTStartup\""
		)
	ENDIF()
ENDMACRO()

CONSTRUCT_EXAMPLES(gif2webp "${GIF2WEBP_SOURCES}")
CONSTRUCT_EXAMPLES(vwebp "${VWEBP_SOURCES}")
CONSTRUCT_EXAMPLES(cwebp "${CWEBP_SOURCES}")
CONSTRUCT_EXAMPLES(dwebp "${DWEBP_SOURCES}")
CONSTRUCT_EXAMPLES(webpmux "${WEBPMUX_SOURCES}")

